<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Coffee Mini App</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root { --accent: #28a745; --primary: #007bff; --danger:#dc3545; --card-bg:#fff; }

  html,body { height:100%; }
  body {
    margin:0;
    font-family: Arial, sans-serif;
    background: #ffffff;
    color: #000;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  h1 {
    margin:0;
    padding:14px 0;
    text-align:center;
    background:#f6f6f6;
    border-bottom:1px solid #e6e6e6;
  }

  .menu {
    padding:12px;
    max-height: calc(100vh - 64px);
    overflow:auto;
  }

  .menu-item {
    display:flex;
    gap:14px;
    align-items:flex-start;
    background:var(--card-bg);
    border-radius:12px;
    box-shadow:0 2px 6px rgba(0,0,0,0.06);
    padding:10px;
    margin-bottom:12px;
  }

  .left {
    display:flex;
    align-items:center;
    gap:10px;
    flex:1 1 auto;
  }

  .left img {
    width:70px;
    height:70px;
    border-radius:8px;
    object-fit:cover;
    flex:0 0 70px;
  }

  .left .meta { line-height:1; }
  .left .meta p { margin:0; }
  .left .meta p.small { font-size:13px; color:#666; }

  .right {
    display:flex;
    flex-direction:column;
    gap:6px;
    flex:0 0 auto;
    align-items:center;
    min-width:92px;
  }

  /* compact selects / inputs */
  .right select,
  .right input[type=number] {
    padding:6px 8px;
    font-size:13px;
    border-radius:10px;
    border:1px solid #d1d1d1;
    width:auto;
    max-width:110px;
    box-sizing:border-box;
    text-align:center;
  }

  .right input[type=number]::-webkit-outer-spin-button,
  .right input[type=number]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  .right button {
    padding:6px 10px;
    font-size:13px;
    border-radius:10px;
    background:var(--primary);
    color:#fff;
    border:0;
    cursor:pointer;
    width:auto;
    align-self:center;
    box-shadow: 0 1px 0 rgba(0,0,0,0.06);
  }
  .right button:active { transform: translateY(1px); }

  /* floating cart FAB */
  #cart-fab {
    position:fixed;
    right:18px;
    bottom:18px;
    width:60px;
    height:60px;
    border-radius:50%;
    background:var(--accent);
    color:#fff;
    font-size:26px;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 6px 20px rgba(0,0,0,0.18);
    cursor:pointer;
    z-index:1200;
  }
  #cart-badge {
    position:absolute;
    top:6px;
    right:6px;
    background:#e53935;
    color:#fff;
    padding:2px 6px;
    font-size:12px;
    border-radius:999px;
    font-weight:600;
  }

  /* modal background (blurred) */
  .modal-backdrop {
    position:fixed;
    inset:0;
    display:none; /* toggle by JS */
    align-items:center;
    justify-content:center;
    background: rgba(0,0,0,0.28);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    z-index:1000;
  }

  .modal-box {
    width:92%;
    max-width:420px;
    background:#fff;
    border-radius:14px;
    box-shadow:0 18px 40px rgba(0,0,0,0.2);
    padding:16px;
    animation:pop .26s ease;
    position:relative;
  }
  @keyframes pop { from{ transform:scale(.95); opacity:0 } to{ transform:scale(1); opacity:1 } }

  .modal-box .close {
    position:absolute;
    right:12px;
    top:8px;
    font-size:20px;
    color:#666;
    cursor:pointer;
  }

  /* cart items inside modal */
  #cart-items { list-style:none; padding:0; margin:6px 0 8px 0; max-height:240px; overflow:auto; }
  #cart-items li {
    display:flex; justify-content:space-between; gap:8px; align-items:center;
    padding:6px 4px; border-bottom:1px solid #f1f1f1; font-size:14px;
  }
  #cart-items li .leftline { display:flex; gap:8px; align-items:center; }
  #cart-items li input[type=number] { width:50px; padding:4px; border-radius:6px; text-align:center; }

  .muted { color:#666; font-size:13px; }

  /* footer fixed inside modal for payment */
  .modal-footer {
    position:sticky;
    bottom:0;
    margin-top:12px;
    background:transparent;
    padding-top:12px;
  }
  .btn-primary {
    width:100%;
    padding:12px;
    background:var(--accent);
    color:#fff;
    border:0;
    border-radius:10px;
    font-size:16px;
    cursor:pointer;
  }

  /* payment QR styling */
  .qr-wrap { text-align:center; margin-bottom:8px; }
  .qr-wrap img { width:100%; max-width:360px; border-radius:10px; display:block; margin:0 auto; }

  /* toast */
  #toast {
    visibility:hidden; position:fixed; left:50%; transform:translateX(-50%); bottom:92px;
    background:#222; color:#fff; padding:10px 14px; border-radius:20px; z-index:1600;
  }
  #toast.show { visibility:visible; animation: fade-in .28s; }
  @keyframes fade-in { from{opacity:0; transform:translate(-50%,6px)} to{opacity:1; transform:translate(-50%,0)} }

  /* make sure interactive things are clickable */
  button, select, input { -webkit-tap-highlight-color: rgba(0,0,0,0.05); }

  /* small screens tweak */
  @media (max-width:420px){
    .left img { width:64px; height:64px; }
    .right { min-width:86px; }
    .right select, .right input[type=number] { max-width:88px; }
  }
</style>
</head>
<body>

<h1>☕ Coffee Menu</h1>

<div class="menu">
  <!-- Americano -->
  <div class="menu-item">
    <div class="left">
      <img src="https://ungroundedcoffee.com/image/cache/data/Products/Beverage/IcedAmericano-600x600-500x500.jpg" alt="Americano">
      <div class="meta">
        <p><strong>Americano</strong></p>
        <p class="small">$1.5</p>
      </div>
    </div>
    <div class="right">
      <select id="sugar_americano" aria-label="sugar americano">
        <option>No sugar</option>
        <option>Normal</option>
        <option>Extra sugar</option>
      </select>
      <select id="ice_americano" aria-label="ice americano">
        <option>Less ice</option>
        <option>Normal ice</option>
        <option>Extra ice</option>
      </select>
      <input id="qty_americano" type="number" value="1" min="1" />
      <button type="button" onclick="addToCart('Americano',1.5,'sugar_americano','ice_americano','qty_americano')">Add</button>
    </div>
  </div>

  <!-- Latte -->
  <div class="menu-item">
    <div class="left">
      <img src="https://ungroundedcoffee.com/image/cache/data/Products/Beverage/Iced-Latte-Ungrounded-Coffee-500x500.jpeg" alt="Latte">
      <div class="meta">
        <p><strong>Latte</strong></p>
        <p class="small">$1.5</p>
      </div>
    </div>
    <div class="right">
      <select id="sugar_latte" aria-label="sugar latte">
        <option>No sugar</option>
        <option>Normal</option>
        <option>Extra sugar</option>
      </select>
      <select id="ice_latte" aria-label="ice latte">
        <option>Less ice</option>
        <option>Normal ice</option>
        <option>Extra ice</option>
      </select>
      <input id="qty_latte" type="number" value="1" min="1" />
      <button type="button" onclick="addToCart('Latte',1.5,'sugar_latte','ice_latte','qty_latte')">Add</button>
    </div>
  </div>

  <!-- Cappuccino -->
  <div class="menu-item">
    <div class="left">
      <img src="https://ungroundedcoffee.com/image/cache/data/00042-500x500.jpg" alt="Cappuccino">
      <div class="meta">
        <p><strong>Cappuccino</strong></p>
        <p class="small">$2</p>
      </div>
    </div>
    <div class="right">
      <select id="sugar_cappuccino" aria-label="sugar cappuccino">
        <option>No sugar</option>
        <option>Normal</option>
        <option>Extra sugar</option>
      </select>
      <select id="ice_cappuccino" aria-label="ice cappuccino">
        <option>Less ice</option>
        <option>Normal ice</option>
        <option>Extra ice</option>
      </select>
      <input id="qty_cappuccino" type="number" value="1" min="1" />
      <button type="button" onclick="addToCart('Cappuccino',2,'sugar_cappuccino','ice_cappuccino','qty_cappuccino')">Add</button>
    </div>
  </div>
</div>

<!-- Floating cart -->
<div id="cart-fab" title="Open cart" onclick="openCart()" role="button" aria-label="Open cart">
  🛒
  <span id="cart-badge" style="display:none">0</span>
</div>

<!-- Cart modal -->
<div id="cart-modal" class="modal-backdrop" aria-hidden="true">
  <div class="modal-box cart-content" role="dialog" aria-modal="true" aria-labelledby="cart-title">
    <div class="close" onclick="closeCart()">✕</div>
    <h3 id="cart-title">Your Cart</h3>
    <ul id="cart-items"></ul>
    <div class="muted" id="cart-total-line">Total: $0.00</div>

    <div class="modal-footer">
      <button id="checkout-btn" class="btn-primary" type="button" onclick="checkout()">✅ Checkout</button>
    </div>
  </div>
</div>

<!-- Checkout/payment modal -->
<div id="checkout-modal" class="modal-backdrop" aria-hidden="true">
  <div class="modal-box checkout-content" role="dialog" aria-modal="true" aria-labelledby="pay-title">
    <div class="close" onclick="closeCheckout()">✕</div>
    <h3 id="pay-title">Payment</h3>

    <!-- Only show total (no itemized list) -->
    <div id="order-summary" style="font-size:17px;font-weight:600;margin-bottom:12px;"></div>

    <div class="qr-wrap">
      <!-- replace qr.jpeg in repo with your JPEG QR file -->
      <img id="qr-image" src="IMG_2032.jpeg" alt="Bank QR" />
    </div>

    <!-- sticky footer inside modal -->
    <div class="modal-footer">
      <button id="paid-btn" class="btn-primary" type="button" onclick="finishOrder()">✅ I Have Paid</button>
    </div>
  </div>
</div>

<!-- toast -->
<div id="toast" role="status" aria-live="polite"></div>

<script>
/* small helper for toast */
function showToast(msg){
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  t.style.visibility = 'visible';
  setTimeout(()=>{ t.style.visibility='hidden'; t.textContent=''; }, 1600);
}

/* cart data */
let cart = [];

/* add item */
function addToCart(name, price, sugarId, iceId, qtyId){
  const sugar = document.getElementById(sugarId).value;
  const ice = document.getElementById(iceId).value;
  const qty = parseInt(document.getElementById(qtyId).value, 10) || 1;
  if(qty <= 0) return;
  cart.push({name, price, sugar, ice, qty});
  updateCart();
  showToast('✔ Added to cart');
}

/* update cart UI */
function updateCart(){
  const ul = document.getElementById('cart-items');
  ul.innerHTML = '';
  cart.forEach((item, idx) => {
    const li = document.createElement('li');
    li.innerHTML = `
      <div class="leftline"><strong>${item.name}</strong>
        <div class="muted" style="margin-left:8px">(${item.sugar}, ${item.ice})</div>
      </div>
      <div style="display:flex;align-items:center;gap:8px">
        x<input type="number" min="1" value="${item.qty}" onchange="updateQty(${idx}, this.value)">
        <span style="min-width:60px;text-align:right">$${(item.price*item.qty).toFixed(2)}</span>
        <button type="button" onclick="removeItem(${idx})" title="Remove">✕</button>
      </div>
    `;
    ul.appendChild(li);
  });

  const total = cart.reduce((s,i)=>s + i.price*i.qty, 0);
  document.getElementById('cart-total-line').textContent = `Total: $${total.toFixed(2)}`;

  const badge = document.getElementById('cart-badge');
  if(cart.length>0){ badge.style.display='inline-block'; badge.textContent = cart.length; }
  else { badge.style.display='none'; }
}

/* qty change */
function updateQty(index, val){
  const q = parseInt(val,10);
  if(!q || q<=0) return;
  cart[index].qty = q;
  updateCart();
}

/* remove item */
function removeItem(index){
  cart.splice(index,1);
  updateCart();
}

/* open / close cart modal */
function openCart(){
  document.getElementById('cart-modal').style.display='flex';
  document.getElementById('cart-fab').style.display='none'; // hide FAB
}
function closeCart(){
  document.getElementById('cart-modal').style.display='none';
  document.getElementById('cart-fab').style.display='flex'; // show FAB again
}
function checkout(){
  if(cart.length === 0){
    alert('❌ Your cart is empty!');
    return;
  }
  closeCart();
  const total = cart.reduce((s,i)=>s + i.price*i.qty, 0);
  document.getElementById('order-summary').innerHTML = `💰 Total: $${total.toFixed(2)}`;
  document.getElementById('checkout-modal').style.display='flex';
  document.getElementById('cart-fab').style.display='none'; // hide FAB during checkout
}
function closeCheckout(){
  document.getElementById('checkout-modal').style.display='none';
  document.getElementById('cart-fab').style.display='flex'; // show FAB again
}

/* finish order */
function finishOrder(){
  // simple confirmation then send data to Telegram (if available)
  if(window.Telegram && Telegram.WebApp){
    Telegram.WebApp.sendData(JSON.stringify({order:cart, paid:true}));
  }
  alert('✅ Order confirmed! Thank you for payment.');
  cart = [];
  updateCart();
  closeCheckout();
}

/* close modal by clicking backdrop */
window.addEventListener('click', function(e){
  const cartModal = document.getElementById('cart-modal');
  const checkoutModal = document.getElementById('checkout-modal');
  if(e.target === cartModal) { closeCart(); }
  if(e.target === checkoutModal) { closeCheckout(); }
});

/* ensure buttons are interactive on mobile (no overlay) */
document.addEventListener('touchstart', ()=>{}, {passive:true});
</script>
</body>
</html>