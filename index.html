<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Coffee Menu</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  /* Your existing CSS remains the same */
  body {
    font-family: system-ui, sans-serif;
    background: #fff;
    margin: 0;
    padding: 0;
  }
  /* ... rest of your CSS ... */
</style>
</head>
<body>

<h1>â˜• Coffee Menu</h1>

<!-- Coffee Items -->
<div class="menu-item">
  <div class="menu-left">
    <img src="https://ungroundedcoffee.com/image/cache/data/Products/Beverage/IcedAmericano-600x600-500x500.jpg" alt="Americano">
    <div class="menu-info">
      <strong>Americano</strong>
      <span>$1.5</span>
    </div>
  </div>
  <div class="menu-right">
    <select id="sugar_americano">
      <option>No sugar</option><option>Normal</option><option>Extra sugar</option>
    </select>
    <select id="ice_americano">
      <option>Less ice</option><option>Normal ice</option><option>Extra ice</option>
    </select>
    <input id="qty_americano" type="number" value="1" min="1">
    <button class="add" onclick="addToCart('americano', 1.5)">Add</button>
  </div>
</div>

<div class="menu-item">
  <div class="menu-left">
    <img src="https://ungroundedcoffee.com/image/cache/data/Products/Beverage/Iced-Latte-Ungrounded-Coffee-500x500.jpeg" alt="Latte">
    <div class="menu-info">
      <strong>Latte</strong>
      <span>$1.5</span>
    </div>
  </div>
  <div class="menu-right">
    <select id="sugar_latte">
      <option>No sugar</option><option>Normal</option><option>Extra sugar</option>
    </select>
    <select id="ice_latte">
      <option>Less ice</option><option>Normal ice</option><option>Extra ice</option>
    </select>
    <input id="qty_latte" type="number" value="1" min="1">
    <button class="add" onclick="addToCart('latte', 1.5)">Add</button>
  </div>
</div>

<div class="menu-item">
  <div class="menu-left">
    <img src="https://ungroundedcoffee.com/image/cache/data/00042-500x500.jpg" alt="Cappuccino">
    <div class="menu-info">
      <strong>Cappuccino</strong>
      <span>$2</span>
    </div>
  </div>
  <div class="menu-right">
    <select id="sugar_cappuccino">
      <option>No sugar</option><option>Normal</option><option>Extra sugar</option>
    </select>
    <select id="ice_cappuccino">
      <option>Less ice</option><option>Normal ice</option><option>Extra ice</option>
    </select>
    <input id="qty_cappuccino" type="number" value="1" min="1">
    <button class="add" onclick="addToCart('cappuccino', 2)">Add</button>
  </div>
</div>

<!-- Floating Cart and Popups remain the same -->
<div class="cart-btn" onclick="openCart()">
  ðŸ›’
  <span class="cart-count" id="cartCount">0</span>
</div>

<div class="popup-bg" id="cartPopup">
  <div class="popup">
    <h2>Your Cart</h2>
    <div id="cartDetails"></div>
    <button onclick="showPayment()">Checkout</button>
    <button class="close-btn" onclick="closePopup('cartPopup')">Close</button>
  </div>
</div>

<div class="popup-bg" id="paymentPopup">
  <div class="popup">
    <h2>Scan QR to Pay</h2>
    <img class="qr" src="IMG_2032.jpeg" alt="QR Code">
    <p id="totalText"></p>
    <button onclick="finishOrder()">I Have Paid</button>
    <button class="close-btn" onclick="closePopup('paymentPopup')">Cancel</button>
  </div>
</div>

<script>
  let cart = [];

  function addToCart(name, price) {
    try {
      const sugar = document.getElementById('sugar_' + name).value;
      const ice = document.getElementById('ice_' + name).value;
      const qty = parseInt(document.getElementById('qty_' + name).value);
      
      cart.push({ 
        name: name.charAt(0).toUpperCase() + name.slice(1), // Capitalize for display
        price, 
        sugar, 
        ice, 
        qty 
      });
      
      updateCartCount();
      alert(`Added ${name} to cart!`); // Debug alert
    } catch (error) {
      console.error('Error adding to cart:', error);
      alert('Error adding item to cart. Please try again.');
    }
  }

  function updateCartCount() {
    document.getElementById('cartCount').innerText = cart.length;
  }

  function openCart() {
    if (cart.length === 0) {
      alert("Your cart is empty!");
      return;
    }
    const details = cart.map(i => 
      `${i.name} x${i.qty} (${i.sugar}, ${i.ice}) - $${(i.price * i.qty).toFixed(2)}`
    ).join("<br>");
    document.getElementById('cartDetails').innerHTML = details;
    document.getElementById('cartPopup').style.display = 'flex';
  }

  function closePopup(id) {
    document.getElementById(id).style.display = 'none';
  }

  function showPayment() {
    document.getElementById('cartPopup').style.display = 'none';
    const total = cart.reduce((sum, i) => sum + i.price * i.qty, 0);
    document.getElementById('totalText').innerText = "Total: $" + total.toFixed(2);
    document.getElementById('paymentPopup').style.display = 'flex';
  }

  function finishOrder() {
    const total = cart.reduce((sum, i) => sum + i.price * i.qty, 0);
    
    // Debug: show what we're sending
    console.log('Sending order:', cart);
    alert('Sending order: ' + JSON.stringify(cart));
    
    if (window.Telegram && Telegram.WebApp) {
      Telegram.WebApp.sendData(JSON.stringify({ 
        order: cart, 
        paid: true, 
        total: total 
      }));
      Telegram.WebApp.close(); // Close the web app after sending
    } else {
      alert("Order submitted (test mode). Total: $" + total.toFixed(2));
    }
    
    cart = [];
    updateCartCount();
    closePopup('paymentPopup');
  }
</script>

</body>
</html>
